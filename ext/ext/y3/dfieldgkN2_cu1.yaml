OUTPUT_DIR: src/cu/amoeba
KERNEL_NAME: dfieldgkN2_cu1
# TEMPLATE_PARAMS:
# CONSTEXPR_FLAGS:
USE_NEIGH: false

# COUNT:
# ENERGY:
# VIRIAL:
# GRADIENT:

# CUT_DISTANCE:
OFF_DISTANCE: 'off'

# EXCLUDE_INFO: dpinfo
# SCALE_1X_TYPE: real2_const_array,0,1

EXTRA_PARAMS: |
  , real (*restrict fields)[3], real (*restrict fieldps)[3]
  , const real* restrict rborn
  , real gkc, real fc, real fd, real fq
IMPLICIT_PARAMS:
  - d::rpole

I_VARIABLES:
  - register real xi   from:x
  - register real yi   from:y
  - register real zi   from:z
  - shared   real ci   from:rpole,MPL_PME_0
  - shared   real dix  from:rpole,MPL_PME_X
  - shared   real diy  from:rpole,MPL_PME_Y
  - shared   real diz  from:rpole,MPL_PME_Z
  - shared   real qixx from:rpole,MPL_PME_XX
  - shared   real qixy from:rpole,MPL_PME_XY
  - shared   real qixz from:rpole,MPL_PME_XZ
  - shared   real qiyy from:rpole,MPL_PME_YY
  - shared   real qiyz from:rpole,MPL_PME_YZ
  - shared   real qizz from:rpole,MPL_PME_ZZ
  - shared   real rbi  from:rborn
K_VARIABLES:
  - register real xk   from:x
  - register real yk   from:y
  - register real zk   from:z
  - register real ck   from:rpole,MPL_PME_0
  - register real dkx  from:rpole,MPL_PME_X
  - register real dky  from:rpole,MPL_PME_Y
  - register real dkz  from:rpole,MPL_PME_Z
  - register real qkxx from:rpole,MPL_PME_XX
  - register real qkxy from:rpole,MPL_PME_XY
  - register real qkxz from:rpole,MPL_PME_XZ
  - register real qkyy from:rpole,MPL_PME_YY
  - register real qkyz from:rpole,MPL_PME_YZ
  - register real qkzz from:rpole,MPL_PME_ZZ
  - register real rbk  from:rborn
I_FORCE:
  - register real fidsx addto:fields,0
  - register real fidsy addto:fields,1
  - register real fidsz addto:fields,2
  - register real fipsx addto:fieldps,0
  - register real fipsy addto:fieldps,1
  - register real fipsz addto:fieldps,2
K_FORCE:
  - register real fkdsx addto:fields,0
  - register real fkdsy addto:fields,1
  - register real fkdsz addto:fields,2
  - register real fkpsx addto:fieldps,0
  - register real fkpsy addto:fieldps,1
  - register real fkpsz addto:fieldps,2

# SCALED_PAIRWISE_INTERACTION:
FULL_PAIRWISE_INTERACTION: |
  real xr = @xk@ - @xi@;
  real yr = @yk@ - @yi@;
  real zr = @zk@ - @zi@;
  real r2 = xr*xr + yr*yr + zr*zr;
  if (r2 <= off * off and incl) {
    pair_dfieldgk(r2, xr, yr, zr, gkc, fc, fd, fq,
      @ci@, @dix@, @diy@, @diz@,
      @qixx@, @qixy@, @qixz@, @qiyy@, @qiyz@, @qizz@, @rbi@,
      @ck@, @dkx@, @dky@, @dkz@,
      @qkxx@, @qkxy@, @qkxz@, @qkyy@, @qkyz@, @qkzz@, @rbk@,
      @fidsx@, @fidsy@, @fidsz@, @fipsx@, @fipsy@, @fipsz@,
      @fkdsx@, @fkdsy@, @fkdsz@, @fkpsx@, @fkpsy@, @fkpsz@);
  }
